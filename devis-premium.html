<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Calculateur de Tarifs - Nico-LA</title>
<style>
@import url('https://fonts.googleapis.com/css2?family=Belleza:wght@400&display=swap');

* {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
}

body {
    font-family: "Belleza", sans-serif;
    background-color: #f0f4f7;
    color: #000000;
    line-height: 1.6;
    padding: 20px;
}

.calculator-container {
    max-width: 800px;
    margin: 0 auto;
    background-color: #ffffff;
    border-radius: 12px;
    box-shadow: 0 8px 25px rgba(0,0,0,0.1);
    overflow: hidden;
}

.calculator-header {
    background: linear-gradient(135deg, #E3B100 0%, #B0780B 100%);
    color: white;
    padding: 30px;
    text-align: center;
}

.calculator-header h1 {
    font-size: 2.2em;
    margin-bottom: 10px;
    font-family: "Belleza", sans-serif;
}

.calculator-header p {
    font-size: 1.1em;
    opacity: 0.9;
}

.calculator-body {
    padding: 40px;
}

.form-group {
    margin-bottom: 25px;
    position: relative;
}

.form-group label {
    display: block;
    margin-bottom: 8px;
    font-weight: 600;
    color: #333;
    font-size: 1.1em;
}

.form-control {
    width: 100%;
    padding: 12px 15px;
    border: 2px solid #e0e0e0;
    border-radius: 8px;
    font-size: 1em;
    font-family: "Belleza", sans-serif;
    transition: all 0.3s ease;
}

.form-control:focus {
    outline: none;
    border-color: #E3B100;
    box-shadow: 0 0 0 3px rgba(227, 177, 0, 0.1);
}

select.form-control {
    cursor: pointer;
}

.input-group {
    display: flex;
    gap: 15px;
    flex-wrap: wrap;
}

.input-group .form-group {
    flex: 1;
    min-width: 200px;
}

.options-grid {
    display: flex;
    flex-direction: column;
    gap: 15px;
}

.option-item {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 15px;
    border: 2px solid #e0e0e0;
    border-radius: 8px;
    transition: all 0.3s ease;
    background-color: #fff;
}

.option-item:hover {
    background-color: #f8f9fa;
    border-color: #E3B100;
}

.option-item label:first-child {
    flex-grow: 1;
    margin: 0;
}

.radio-group {
    display: flex;
    gap: 15px;
    align-items: center;
}

.radio-group label {
    display: flex;
    align-items: center;
    gap: 5px;
    margin: 0;
    cursor: pointer;
    font-weight: normal;
}

.radio-group input[type="radio"] {
    accent-color: #E3B100;
}

.parking-input {
    margin-left: 20px;
    padding: 10px;
    background-color: #f8f9fa;
    border-radius: 5px;
    border: 1px solid #dee2e6;
    transition: all 0.3s ease;
}

.option-detail {
    color: #666;
    font-style: italic;
    display: block;
    margin-top: 3px;
}

.materials-container {
    background-color: #f8f9fa;
    border: 2px solid #E3B100;
    border-radius: 10px;
    padding: 20px;
    margin-top: 20px;
    transition: all 0.3s ease;
}

.materials-header {
    font-size: 1.1em;
    color: #B0780B;
    margin-bottom: 15px;
    text-align: center;
}

.materials-info {
    background-color: #e8f4fd;
    border: 1px solid #bee5eb;
    color: #0c5460;
    padding: 15px;
    border-radius: 8px;
    margin-bottom: 15px;
    font-size: 0.95em;
    line-height: 1.5;
}

.materials-checkbox, .disclaimer-checkbox {
    display: flex;
    align-items: center;
    gap: 10px;
    justify-content: center;
    padding: 15px;
    background-color: #fff;
    border-radius: 8px;
    border: 2px solid #dee2e6;
    transition: all 0.3s ease;
}

.materials-checkbox input[type="checkbox"], .disclaimer-checkbox input[type="checkbox"] {
    width: 18px;
    height: 18px;
    accent-color: #E3B100;
}

.materials-checkbox label, .disclaimer-checkbox label {
    margin: 0;
    cursor: pointer;
    font-weight: 500;
}

.disclaimer-note {
    background-color: #f8f9fa;
    border: 2px solid #E3B100;
    border-radius: 10px;
    padding: 20px;
    margin-top: 30px;
    transition: all 0.3s ease;
}

.disclaimer-header {
    font-size: 1.1em;
    color: #495057;
    margin-bottom: 15px;
    text-align: center;
}

.disclaimer-info {
    background-color: #e8f4fd;
    border: 1px solid #bee5eb;
    color: #0c5460;
    padding: 15px;
    border-radius: 8px;
    margin-bottom: 15px;
    font-size: 0.95em;
    line-height: 1.5;
    text-align: center;
}

/* √âtats de validation */
.error-field {
    border-color: #dc3545 !important;
    box-shadow: 0 0 0 3px rgba(220, 53, 69, 0.15) !important;
    background-color: #fff5f5 !important;
}

.success-field {
    border-color: #28a745 !important;
    box-shadow: 0 0 0 3px rgba(40, 167, 69, 0.15) !important;
    background-color: #f8fff8 !important;
}

.error-checkbox, .error-option {
    background-color: #f8d7da !important;
    border-color: #dc3545 !important;
}

.success-checkbox, .success-option {
    background-color: #d4edda !important;
    border-color: #28a745 !important;
}

.alert {
    background-color: #fff3cd;
    border: 1px solid #ffeaa7;
    color: #856404;
    padding: 15px;
    border-radius: 8px;
    margin: 20px 0;
    display: none;
}

.alert-warning {
    background-color: #f8d7da;
    border-color: #f5c6cb;
    color: #721c24;
}

.result-container {
    background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
    border-radius: 12px;
    padding: 30px;
    margin-top: 30px;
    border: 2px solid #E3B100;
    display: none;
}

.result-title {
    font-size: 1.5em;
    color: #B0780B;
    margin-bottom: 20px;
    text-align: center;
}

.result-line {
    display: flex;
    justify-content: space-between;
    align-items: flex-start;
    padding: 8px 0;
    border-bottom: 1px solid #dee2e6;
    gap: 15px;
}

.result-line:last-child {
    border-bottom: none;
    font-weight: bold;
    font-size: 1.2em;
    color: #B0780B;
    border-top: 2px solid #E3B100;
    padding-top: 15px;
    margin-top: 10px;
}

.result-line[data-options] {
    flex-direction: column;
    align-items: flex-start;
}

.result-line[data-options] span:last-child {
    margin-top: 5px;
    margin-left: 20px;
    font-style: italic;
}

.price-highlight {
    background: linear-gradient(135deg, #E3B100 0%, #B0780B 100%);
    color: white;
    padding: 20px;
    border-radius: 8px;
    text-align: center;
    margin-top: 20px;
}

.price-highlight .final-price {
    font-size: 2em;
    font-weight: bold;
    margin-bottom: 5px;
}

.price-highlight .credit-info {
    font-size: 0.9em;
    opacity: 0.9;
}

@media (max-width: 768px) {
    .calculator-body {
        padding: 20px;
    }
    
    .input-group {
        flex-direction: column;
    }
    
    .input-group .form-group {
        min-width: 100%;
    }
    
    .calculator-header h1 {
        font-size: 1.8em;
    }
}
</style>
</head>
<body>
    <div class="calculator-container">
        <div class="calculator-header">
            <h1>üßæ Calculateur de Tarifs PREMIUM*</h1>
            <p>Obtenez une estimation personnalis√©e en quelques clics<br>
            et recommencez autant que vous voulez <span style="color: #007bff; font-weight: bold;">&#10145;</span> Actualisez la page</p>
        </div>
        
        <div class="calculator-body">
            <div class="disclaimer-note" id="disclaimerContainer">
                <div class="disclaimer-header">
                    <strong>* Outil mis √† disposition du Client</strong>
                </div>
                <div class="disclaimer-info">
                    M√™me si le prix devrait √™tre proche du TTC r√©el final, il devra n√©anmoins √™tre contr√¥l√© et ajust√© si n√©cessaire par l'auteur des travaux. Merci de votre compr√©hension.
                </div>
                <div class="disclaimer-checkbox" id="disclaimerCheckbox">
                    <label for="disclaimer">J'ai compris que le prix n'est qu'indicatif</label>
                    <input type="checkbox" id="disclaimer" data-type="disclaimer">
                </div>
            </div>

            <form id="calculatorForm">
                <div class="form-group">
                    <label for="service">üîß Choisissez votre service :</label>
                    <select id="service" class="form-control" required>
                        <option value="">-- S√©lectionnez un service --</option>
                        <optgroup label="üåø FORMULE ZEN - 30‚Ç¨/h HT">
                            <option value="assistance_admin" data-rate="30">Assistance administrative</option>
                            <option value="depannage_info" data-rate="30">D√©pannage informatique</option>
                            <option value="creation_site" data-rate="30" data-special="devis">Cr√©ation site internet</option>
                            <option value="rondes_domicile" data-rate="30">Rondes contr√¥le domicile</option>
                            <option value="livraison_courses" data-rate="30">Livraison de courses</option>
                        </optgroup>
                        <optgroup label="üåø FORMULE ZEN - 35‚Ç¨/h HT">
                            <option value="pose_mobilier" data-rate="35">Pose mobilier/parasol/barbecue/cadres</option>
                            <option value="jardinage" data-rate="35">Tonte/taille/d√©sherbage/jardinage</option>
                            <option value="nettoyage_terrasses" data-rate="35">Nettoyage terrasses et all√©es</option>
                            <option value="debarras_dechetterie" data-rate="35">D√©barras d√©chetterie</option>
                        </optgroup>
                        <optgroup label="üåø FORMULE ZEN - 40‚Ç¨/h HT">
                            <option value="panne_electromenager" data-rate="40">Panne √âlectrom√©nager</option>
                            <option value="motoculture_simple" data-rate="40">Panne Motoculture (simple)</option>
                            <option value="hygiene_cyclonique" data-rate="40">Hygi√®ne cyclonique professionnelle</option>
                            <option value="electricite_simple" data-rate="40">√âlectricit√© (simple)</option>
                            <option value="plomberie_simple" data-rate="40">Plomberie (simple)</option>
                            <option value="vehicule_simple" data-rate="40">Moto/Scooter/Voiture (simple)</option>
                            <option value="dashcam" data-rate="40">Installation DashCam</option>
                            <option value="cameras_surveillance" data-rate="40">Installation cam√©ras surveillance</option>
                            <option value="volet_roulant" data-rate="40">Volet roulant</option>
                            <option value="moustiquaire" data-rate="40">Moustiquaire</option>
                            <option value="portail_electrique" data-rate="40">Portail √©lectrique</option>
                        </optgroup>
                        <optgroup label="‚≠ê FORMULE PREMIUM - 50‚Ç¨/h HT">
                            <option value="electrification_velo" data-rate="50" data-special="vae">√âlectrification d'un v√©lo</option>
                            <option value="motoculture_difficile" data-rate="50">Panne Motoculture (difficile)</option>
                            <option value="debarras_gros" data-rate="50">D√©barras caves/greniers/garages</option>
                            <option value="demolition" data-rate="50">D√©pose cloisons/d√©molition int√©rieure</option>
                            <option value="montage_cuisine" data-rate="50">Montage cuisines √©quip√©es/gros meubles</option>
                        </optgroup>
                        <optgroup label="‚≠ê FORMULE PREMIUM - 60‚Ç¨/h HT">
                            <option value="vehicule_difficile" data-rate="60">Moto/Scooter/Voiture (difficile)</option>
                            <option value="toiture" data-rate="60">R√©paration toitures/goutti√®res/bardages</option>
                            <option value="taches_complexes" data-rate="60" data-special="devis">T√¢ches complexes (techniques sp√©cialis√©es)</option>
                            <option value="taches_physiques" data-rate="60" data-special="devis">T√¢ches physiques (tr√®s lourdes/r√©p√©titives)</option>
                            <option value="taches_dangereuses" data-rate="60" data-special="devis">T√¢ches dangereuses (hauteur/produits chimiques)</option>
                        </optgroup>
                    </select>
                </div>

                <div class="alert alert-warning" id="devisAlert">
                    <strong>‚ö†Ô∏è Devis personnalis√© obligatoire.</strong><br>
                    Ce type de prestation n√©cessite une √©valuation personnalis√©e. Le calculateur peut donner une estimation indicative pour d'autres prestations, mais pour celle-ci, un devis d√©taill√© sera √©tabli en collaboration avec vous selon vos besoins sp√©cifiques.
                    <br><br>
                    <div style="text-align: center; margin-top: 15px;">
                        <a href="https://nico-la-contact.carrd.co/" target="_blank" style="display: inline-block; background: linear-gradient(135deg, #E3B100 0%, #B0780B 100%); color: white; padding: 15px 25px; border-radius: 8px; text-decoration: none; font-weight: bold; font-size: 1.1em; cursor: pointer; box-shadow: 0 4px 8px rgba(0,0,0,0.2); transition: all 0.3s ease;" onmouseover="this.style.transform='translateY(-2px)'; this.style.boxShadow='0 6px 12px rgba(0,0,0,0.3)'" onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='0 4px 8px rgba(0,0,0,0.2)'">
                            Contactez Nico pour un devis personnalis√©
                        </a>
                    </div>
                </div>

                <div class="alert" id="vaeAlert" style="background-color: #e8f4fd; border: 2px solid #0c5460; color: #0c5460; display: none;">
                    <strong>üö¥‚Äç‚ôÇÔ∏è Information importante sur l'√©lectrification d'un v√©lo</strong><br><br>
                    
                    <strong>‚öñÔ∏è R√©glementation fran√ßaise et europ√©enne :</strong><br>
                    La r√©glementation fran√ßaise (et europ√©enne, directive 2002/24/CE puis r√®glement UE 168/2013) encadre tr√®s pr√©cis√©ment ce qui peut devenir un <strong>v√©lo √† assistance √©lectrique (VAE)</strong>.<br><br>
                    
                    Un <strong>VAE homologu√©</strong> doit obligatoirement r√©pondre √† la norme <strong>EN 15194</strong> :<br>
                    ‚Ä¢ assistance uniquement quand on p√©dale (pas de poign√©e d'acc√©l√©rateur seule)<br>
                    ‚Ä¢ moteur ‚â§ 250 W<br>
                    ‚Ä¢ assistance qui se coupe √† 25 km/h<br>
                    ‚Ä¢ conformit√© technique (freinage, √©clairage, marquages CE, etc.)<br><br>
                    
                    <strong>üëâ Cela exclut d'embl√©e certains types de v√©los :</strong><br><br>
                    
                    <strong>1. V√©los d√©j√† motoris√©s autrement</strong><br>
                    V√©los √©quip√©s d'un moteur thermique (cyclomoteurs, solex, etc.) ‚Üí ne peuvent pas √™tre homologu√©s comme VAE.<br><br>
                    
                    <strong>2. V√©los con√ßus sans p√©dales</strong><br>
                    Trottinettes, draisiennes √©lectriques, engins assimil√©s EDPM ‚Üí pas de p√©dalage = impossible de les faire homologuer comme VAE.<br><br>
                    
                    <strong>3. V√©los trop puissants ou trop rapides</strong><br>
                    Si le kit d√©passe 250 W ou que l'assistance va au-del√† de 25 km/h ‚Üí ce n'est plus un VAE mais un <strong>speed bike</strong> (cyclomoteur) ‚Üí immatriculation, assurance, casque homologu√©, etc.<br><br>
                    
                    <strong>4. V√©los inadapt√©s structurellement</strong><br>
                    Cadres trop anciens ou fragiles qui ne supporteraient pas l'ajout d'un kit moteur/batterie ‚Üí en pratique, ils ne pourraient pas passer l'homologation.<br><br>
                    
                    <strong>5. V√©los modifi√©s sans respect des normes CE</strong><br>
                    Si le montage d'un kit n'est pas certifi√© conforme √† la norme EN 15194 ‚Üí le v√©lo perd sa conformit√© et n'a plus le statut l√©gal de VAE.<br><br>
                    
                    <strong>‚öñÔ∏è En r√©sum√© :</strong><br>
                    Seuls les v√©los √† p√©dales, non motoris√©s √† l'origine, transform√©s avec un kit conforme et limit√© (250 W / 25 km/h / coupure √† l'arr√™t du p√©dalage) peuvent devenir des VAE l√©gaux.<br><br>
                    
                    <strong>üîß Notre prestation comprend :</strong><br>
                    ‚Ä¢ 3h d'√©lectrification (50‚Ç¨/h HT)<br>
                    ‚Ä¢ 2h de finitions/r√©glages (35‚Ç¨/h HT)<br>
                    ‚Ä¢ Total : 5h de travail sp√©cialis√©
                </div>

                <div class="input-group">
                    <div class="form-group" id="hoursGroup">
                        <label for="hours">‚è±Ô∏è Nombre d'heures estim√©es :</label>
                        <input type="number" id="hours" class="form-control" min="1" step="1" value="" placeholder="Ex: 3" required>
                    </div>
                    
                    <div class="form-group">
                        <label for="trips">üöó Nombre de d√©placements chez le client :</label>
                        <input type="number" id="trips" class="form-control" min="1" value="" placeholder="Ex: 1" required>
                    </div>
                </div>

                <div class="form-group">
                    <label>üõ†Ô∏è Options suppl√©mentaires :</label>
                    <div class="options-grid">
                        <div class="option-item" data-option="evening">
                            <label><strong>Intervention soir√©e</strong> (apr√®s 18h)<br><small class="option-detail">+20% sur le taux horaire</small></label>
                            <div class="radio-group">
                                <label><input type="radio" name="evening" value="-" checked> -</label>
                                <label><input type="radio" name="evening" value="non"> Non</label>
                                <label><input type="radio" name="evening" value="oui"> Oui</label>
                            </div>
                        </div>
                        <div class="option-item" data-option="difficult_access">
                            <label><strong>Acc√®s difficile</strong> (‚â•3e √©tage sans ascenseur)<br><small class="option-detail">+15‚Ç¨ TTC</small></label>
                            <div class="radio-group">
                                <label><input type="radio" name="difficult_access" value="-" checked> -</label>
                                <label><input type="radio" name="difficult_access" value="non"> Non</label>
                                <label><input type="radio" name="difficult_access" value="oui"> Oui</label>
                            </div>
                        </div>
                        <div class="option-item" data-option="parking">
                            <label><strong>Parking payant</strong><br><small class="option-detail">+5‚Ç¨ TTC par demi-journ√©e</small></label>
                            <div class="radio-group">
                                <label><input type="radio" name="parking" value="-" checked> -</label>
                                <label><input type="radio" name="parking" value="non"> Non</label>
                                <label><input type="radio" name="parking" value="oui"> Oui</label>
                            </div>
                        </div>
                        <div class="parking-input" id="parkingInput" style="display: none;">
                            <label for="parking_days"><strong>Nombre de fois o√π le parking payant sera utilis√© :</strong></label>
                            <input type="number" id="parking_days" class="form-control" min="1" step="1" value="" placeholder="Entrez un nombre ‚â• 1" style="width: 340px; display: inline-block; margin-left: 10px;">
                            <small style="display: block; color: #666; margin-top: 5px; font-style: italic;">
                                üí° Indiquez le nombre total de fois o√π le parking payant sera utilis√© (minimum 1)
                            </small>
                        </div>
                        <div class="option-item" data-option="cleaning">
                            <label><strong>Nettoyage post-intervention</strong><br><small class="option-detail">+15‚Ç¨ TTC</small></label>
                            <div class="radio-group">
                                <label><input type="radio" name="cleaning" value="-" checked> -</label>
                                <label><input type="radio" name="cleaning" value="non"> Non</label>
                                <label><input type="radio" name="cleaning" value="oui"> Oui</label>
                            </div>
                        </div>
                        <div class="option-item" data-option="waste_removal">
                            <label><strong>√âvacuation d√©chets/gravats</strong><br><small class="option-detail">+20‚Ç¨ TTC</small></label>
                            <div class="radio-group">
                                <label><input type="radio" name="waste_removal" value="-" checked> -</label>
                                <label><input type="radio" name="waste_removal" value="non"> Non</label>
                                <label><input type="radio" name="waste_removal" value="oui"> Oui</label>
                            </div>
                        </div>
                        <div class="option-item" data-option="long_distance">
                            <label><strong>D√©placement longue distance</strong> (>50km)<br><small class="option-detail">+30‚Ç¨ HT</small></label>
                            <div class="radio-group">
                                <label><input type="radio" name="long_distance" value="-" checked> -</label>
                                <label><input type="radio" name="long_distance" value="non"> Non</label>
                                <label><input type="radio" name="long_distance" value="oui"> Oui</label>
                            </div>
                        </div>
                    </div>
                    
                    <div class="materials-container">
                        <div class="materials-header">
                            <strong>Si mat√©riel achet√© pour le chantier</strong>
                        </div>
                        <div class="materials-info">
                            <strong>üí° Information importante :</strong> Conform√©ment √† la r√©glementation des services √† la personne, tout mat√©riel achet√© pour votre chantier est factur√© au prix co√ªtant, sans aucune marge.
                        </div>
                        <div class="materials-checkbox" id="materialsCheckbox">
                            <label for="materials">J'ai compris : Si mat√©riel achet√© <span style="color: #007bff; font-weight: bold;">&#10145;</span> mat√©riel factur√© √† prix co√ªtant (sans marge)</label>
                            <input type="checkbox" id="materials" data-type="note">
                        </div>
                    </div>
                </div>

            </form>

            <div class="result-container" id="resultContainer">
                <div class="result-title">üìä Estimation de votre devis</div>
                <div class="result-line">
                    <span><u>Service s√©lectionn√© :</u></span>
                    <span id="selectedService">-</span>
                </div>
                <div class="result-line">
                    <span><u>Tarif horaire de base :</u></span>
                    <span id="baseHourlyRate">-</span>
                </div>
                <div class="result-line">
                    <span><u>Tarif horaire final :</u></span>
                    <span id="hourlyRate">-</span>
                </div>
                <div class="result-line">
                    <span><u>Dur√©e :</u></span>
                    <span id="duration">-</span>
                </div>
                <div class="result-line">
                    <span><u>D√©placement :</u></span>
                    <span id="tripsCount">-</span>
                </div>
                <div class="result-line" data-options>
                    <span><u>Options suppl√©mentaires :</u></span>
                    <span id="optionsDetail">-</span>
                </div>
                <div class="result-line">
                    <span><u>Sous-total HT :</u></span>
                    <span id="subtotalHT">-</span>
                </div>
                <div class="result-line">
                    <span><u>TVA (10%) :</u></span>
                    <span id="tva">-</span>
                </div>
                <div class="result-line" style="font-size: 1.4em; font-weight: bold;">
                    <span><u>Total TTC :</u></span>
                    <span id="totalTTC">-</span>
                </div>
                
                <div class="price-highlight">
                    <div class="final-price" id="finalPrice">-</div>
                    <div class="credit-info">Prix final apr√®s cr√©dit d'imp√¥t 50%**</div>
                </div>
                <div style="text-align: right; margin-top: 15px; font-size: 0.9em; color: #666;">
                    ** Sous r√©serve d'√©ligibilit√© aux services √† la personne
                </div>
            </div>
        </div>
    </div>

    <script>
        // Variables globales
        const serviceSelect = document.getElementById('service');
        const hoursInput = document.getElementById('hours');
        const hoursGroup = document.getElementById('hoursGroup');
        const tripsInput = document.getElementById('trips');
        const parkingDaysInput = document.getElementById('parking_days');
        const parkingInputDiv = document.getElementById('parkingInput');
        const materialsCheck = document.getElementById('materials');
        const disclaimerCheck = document.getElementById('disclaimer');
        const resultContainer = document.getElementById('resultContainer');
        const devisAlert = document.getElementById('devisAlert');
        const vaeAlert = document.getElementById('vaeAlert');

        // Co√ªts fixes
        const TRIP_COST = 30;
        const TVA_RATE = 0.10;
        const CREDIT_RATE = 0.50;

        // Fonction de validation des champs
        function validateField(element, isValid) {
            if (isValid) {
                element.classList.remove('error-field');
                element.classList.add('success-field');
            } else {
                element.classList.remove('success-field');
                element.classList.add('error-field');
            }
        }

        // Fonction de validation des options
        function validateOption(element, isValid) {
            if (isValid) {
                element.classList.remove('error-option');
                element.classList.add('success-option');
            } else {
                element.classList.remove('success-option');
                element.classList.add('error-option');
            }
        }

        // Fonction de validation des checkboxes
        function validateCheckbox(element, isValid) {
            if (isValid) {
                element.classList.remove('error-checkbox');
                element.classList.add('success-checkbox');
            } else {
                element.classList.remove('success-checkbox');
                element.classList.add('error-checkbox');
            }
        }

        // Fonction de validation imm√©diate du disclaimer principal
        function validateDisclaimerBlock() {
            const disclaimerContainer = document.getElementById('disclaimerContainer');
            const calculatorForm = document.getElementById('calculatorForm');
            
            if (disclaimerCheck.checked) {
                disclaimerContainer.classList.remove('error-checkbox');
                disclaimerContainer.classList.add('success-checkbox');
                
                // V√©rifier si un service "devis" est s√©lectionn√©
                const selectedOption = serviceSelect.options[serviceSelect.selectedIndex];
                if (selectedOption && selectedOption.dataset.special === 'devis') {
                    // Ne pas activer le formulaire, laisser la logique devis g√©rer
                    return;
                }
                
                // Activer le formulaire seulement si pas de service devis
                calculatorForm.style.opacity = '1';
                calculatorForm.style.pointerEvents = 'auto';
            } else {
                disclaimerContainer.classList.remove('success-checkbox');
                disclaimerContainer.classList.add('error-checkbox');
                
                // Griser le formulaire
                calculatorForm.style.opacity = '0.5';
                calculatorForm.style.pointerEvents = 'none';
            }
        }

        // Fonction de validation globale de TOUS les champs
        function applyGlobalValidation() {
            console.log('=== VALIDATION GLOBALE APPLIQU√âE ===');
            
            // 1. Validation champ heures (si visible)
            if (hoursGroup.style.display !== 'none') {
                const hours = parseInt(hoursInput.value) || 0;
                validateField(hoursInput, hours >= 1);
            }
            
            // 2. Validation champ d√©placements
            const trips = parseInt(tripsInput.value) || 0;
            validateField(tripsInput, trips >= 1);
            
            // 3. Validation champ parking (si visible)
            const parkingValue = document.querySelector('input[name="parking"]:checked')?.value;
            if (parkingValue !== 'non') {
                parkingInputDiv.style.display = 'block';
                const parkingDays = parseInt(parkingDaysInput.value) || 0;
                validateField(parkingDaysInput, parkingDays >= 1);
            } else {
                parkingInputDiv.style.display = 'none';
                parkingDaysInput.classList.remove('error-field', 'success-field');
            }
            
            // 4. Validation de TOUTES les options radio
            const radioGroups = ['evening', 'difficult_access', 'parking', 'cleaning', 'waste_removal', 'long_distance'];
            radioGroups.forEach(groupName => {
                const selectedValue = document.querySelector(`input[name="${groupName}"]:checked`)?.value;
                const optionElement = document.querySelector(`input[name="${groupName}"]`).closest('.option-item');
                const isValid = selectedValue !== '-';
                validateOption(optionElement, isValid);
            });
            
            // 5. Validation des checkboxes
            validateCheckbox(document.getElementById('materialsCheckbox'), materialsCheck.checked);
            validateCheckbox(document.getElementById('disclaimerCheckbox'), disclaimerCheck.checked);
            
            // 6. Validation du conteneur disclaimer principal
            const disclaimerContainer = document.getElementById('disclaimerContainer');
            if (disclaimerCheck.checked) {
                disclaimerContainer.classList.remove('error-checkbox');
                disclaimerContainer.classList.add('success-checkbox');
            } else {
                disclaimerContainer.classList.remove('success-checkbox');
                disclaimerContainer.classList.add('error-checkbox');
            }
            
            console.log('=== VALIDATION GLOBALE TERMIN√âE ===');
        }

        // Fonction principale de validation et calcul
        function updateCalculation() {
            console.log('=== updateCalculation NOUVELLE VERSION ===');
            
            // 1. Validation du service
            const serviceValid = serviceSelect.value !== "";
            validateField(serviceSelect, serviceValid);

            if (!serviceValid) {
                resultContainer.style.display = 'none';
                vaeAlert.style.display = 'none';
                devisAlert.style.display = 'none';
                return;
            }

            // 2. D√®s qu'un service est s√©lectionn√©, appliquer la validation globale
            applyGlobalValidation();

            const selectedOption = serviceSelect.options[serviceSelect.selectedIndex];
            console.log('Service:', selectedOption.value, 'Special:', selectedOption.dataset.special);

            // Gestion sp√©ciale pour l'√©lectrification de v√©lo
            if (selectedOption.dataset.special === 'vae') {
                console.log('=== MODE VAE NOUVELLE VERSION ===');
                vaeAlert.style.display = 'block';
                hoursGroup.style.display = 'none';
                devisAlert.style.display = 'none';
                
                // Pour VAE, ne calculer que si TOUT est valide
                calculatePriceVAE();
                return;
            } else {
                vaeAlert.style.display = 'none';
                hoursGroup.style.display = 'block';
            }

            // 2. V√©rifier si devis obligatoire
            if (selectedOption.dataset.special === 'devis') {
                devisAlert.style.display = 'block';
                resultContainer.style.display = 'none';
                
                // V√©rifier d'abord si le disclaimer est coch√©
                if (!disclaimerCheck.checked) {
                    // Si disclaimer pas coch√©, tout reste gris√©
                    return;
                }
                
                // Si disclaimer coch√©, griser seulement les √©l√©ments du formulaire, pas l'alert
                const formElements = document.querySelectorAll('#calculatorForm input, #calculatorForm select, #calculatorForm .option-item, #calculatorForm .materials-container');
                formElements.forEach(element => {
                    element.style.opacity = '0.5';
                    element.style.pointerEvents = 'none';
                });
                
                return;
            } else {
                devisAlert.style.display = 'none';
                
                // V√©rifier si le disclaimer est coch√© avant de r√©activer
                if (!disclaimerCheck.checked) {
                    // Si disclaimer pas coch√©, garder tout gris√©
                    return;
                }
                
                // R√©activer tous les √©l√©ments du formulaire
                const formElements = document.querySelectorAll('#calculatorForm input, #calculatorForm select, #calculatorForm .option-item, #calculatorForm .materials-container');
                formElements.forEach(element => {
                    element.style.opacity = '1';
                    element.style.pointerEvents = 'auto';
                });
            }

            // Calcul pour les autres services
            calculatePriceNormal();
        }

        // Fonction sp√©cifique pour l'√©lectrification VAE
        function calculatePriceVAE() {
            console.log('=== CALCUL VAE SIMPLIFI√â ===');
            
            const selectedOption = serviceSelect.options[serviceSelect.selectedIndex];
            const trips = parseInt(tripsInput.value) || 1; // Valeur par d√©faut pour test
            
            // R√©cup√©ration de TOUTES les options
            const eveningValue = document.querySelector('input[name="evening"]:checked')?.value || 'non';
            const difficultAccessValue = document.querySelector('input[name="difficult_access"]:checked')?.value || 'non';
            const parkingValue = document.querySelector('input[name="parking"]:checked')?.value || 'non';
            const cleaningValue = document.querySelector('input[name="cleaning"]:checked')?.value || 'non';
            const wasteRemovalValue = document.querySelector('input[name="waste_removal"]:checked')?.value || 'non';
            const longDistanceValue = document.querySelector('input[name="long_distance"]:checked')?.value || 'non';
            
            console.log('VAE - Options:', {eveningValue, difficultAccessValue, parkingValue, cleaningValue, wasteRemovalValue, longDistanceValue});

            // Calcul des co√ªts VAE
            let electrificationCost, finitionsCost, hoursCostHT;
            
            if (eveningValue === 'oui') {
                electrificationCost = 3 * (50 * 1.20); // 180‚Ç¨ HT
                finitionsCost = 2 * (35 * 1.20); // 84‚Ç¨ HT
                hoursCostHT = electrificationCost + finitionsCost; // 264‚Ç¨ HT
            } else {
                electrificationCost = 3 * 50; // 150‚Ç¨ HT
                finitionsCost = 2 * 35; // 70‚Ç¨ HT
                hoursCostHT = electrificationCost + finitionsCost; // 220‚Ç¨ HT
            }

            // D√©placements
            const tripsCostHT = 30 * trips;

            // Options suppl√©mentaires
            let optionsText = [];
            let optionsCostHT = 0;
            let optionsCostTTC = 0;

            if (eveningValue === 'oui') {
                optionsText.push('Intervention soir√©e (+20% sur le prix HT)');
            }

            // Options avec co√ªt fixe TTC
            if (difficultAccessValue === 'oui') {
                optionsCostTTC += 15;
                optionsText.push('Acc√®s difficile (+15‚Ç¨ TTC)');
            }

            if (cleaningValue === 'oui') {
                optionsCostTTC += 15;
                optionsText.push('Nettoyage (+15‚Ç¨ TTC)');
            }

            if (wasteRemovalValue === 'oui') {
                optionsCostTTC += 20;
                optionsText.push('√âvacuation d√©chets (+20‚Ç¨ TTC)');
            }

            // Parking payant
            if (parkingValue === 'oui') {
                const parkingDays = parseInt(parkingDaysInput.value) || 1;
                const parkingCost = parkingDays * 5;
                optionsCostTTC += parkingCost;
                optionsText.push(`Parking payant (${parkingDays} utilisation${parkingDays > 1 ? 's' : ''}: +${parkingCost}‚Ç¨ TTC)`);
                // Afficher le champ parking
                parkingInputDiv.style.display = 'block';
            } else {
                parkingInputDiv.style.display = 'none';
            }

            // D√©placement longue distance (HT)
            if (longDistanceValue === 'oui') {
                optionsCostHT += 30;
                optionsText.push('Longue distance (+30‚Ç¨ HT)');
            }

            console.log('VAE - Options calcul√©es:', {optionsText, optionsCostHT, optionsCostTTC});

            // Calculs finaux
            const subtotalHT = hoursCostHT + tripsCostHT + optionsCostHT;
            const optionsCostHTFromTTC = optionsCostTTC / (1 + TVA_RATE);
            const totalHT = subtotalHT + optionsCostHTFromTTC;
            const tva = totalHT * TVA_RATE;
            const totalTTC = totalHT + tva;
            const finalPrice = totalTTC * CREDIT_RATE;

            console.log('VAE - Totaux finaux:', {subtotalHT, totalHT, tva, totalTTC, finalPrice});

            // Affichage
            document.getElementById('selectedService').textContent = selectedOption.text;
            document.getElementById('baseHourlyRate').textContent = "√âlectrification: 50‚Ç¨/h HT ‚Ä¢ Finitions: 35‚Ç¨/h HT";
            
            if (eveningValue === 'oui') {
                document.getElementById('hourlyRate').textContent = "3h √©lectrification (60‚Ç¨/h HT) + 2h finitions (42‚Ç¨/h HT) = 264‚Ç¨ HT (base + 20% sur le prix HT)";
            } else {
                document.getElementById('hourlyRate').textContent = "3h √©lectrification (50‚Ç¨/h HT) + 2h finitions (35‚Ç¨/h HT) = 220‚Ç¨ HT";
            }
            
            document.getElementById('duration').textContent = "5h (fixe pour transformation compl√®te)";
            document.getElementById('tripsCount').textContent = trips === 1 ? 
                `${trips} d√©placement √ó 30‚Ç¨ = ${tripsCostHT}‚Ç¨ HT` : 
                `${trips} d√©placements √ó 30‚Ç¨ = ${tripsCostHT}‚Ç¨ HT`;
            document.getElementById('optionsDetail').textContent = optionsText.length > 0 ? optionsText.join(' ‚Ä¢ ') : 'Aucune';
            document.getElementById('subtotalHT').textContent = `${totalHT.toFixed(2)}‚Ç¨`;
            document.getElementById('tva').textContent = `${tva.toFixed(2)}‚Ç¨`;
            document.getElementById('totalTTC').textContent = `${totalTTC.toFixed(2)}‚Ç¨`;
            document.getElementById('finalPrice').textContent = `${finalPrice.toFixed(2)}‚Ç¨`;

            // Ajouter disclaimer VAE
            const existingDisclaimer = document.querySelector('.vae-disclaimer');
            if (!existingDisclaimer) {
                const disclaimer = document.createElement('div');
                disclaimer.className = 'vae-disclaimer';
                disclaimer.style.cssText = 'background-color: #fff3cd; border: 1px solid #ffeaa7; color: #856404; padding: 10px; border-radius: 5px; margin-top: 10px; font-size: 0.9em;';
                disclaimer.innerHTML = '<strong>‚ö†Ô∏èMoteur, batteries, accessoires et fournitures non-inclus dans cette estimation TTC. √Ä rajouter sur devis car les mod√®les varient selon les projets. Prix moyen de tout cet √©quipement de marque VARSTROM= 700‚Ç¨ TTC</strong>';
                resultContainer.appendChild(disclaimer);
            }

            resultContainer.style.display = 'block';
            console.log('=== VAE AFFICHAGE TERMIN√â ===');
        }

        // Fonction pour les services normaux
        function calculatePriceNormal() {
            console.log('=== CALCUL SERVICE NORMAL ===');
            
            const selectedOption = serviceSelect.options[serviceSelect.selectedIndex];
            const hourlyRate = parseFloat(selectedOption.dataset.rate);
            const hours = parseInt(hoursInput.value) || 0;
            const trips = parseInt(tripsInput.value) || 0;

            if (hours === 0 || trips === 0) {
                resultContainer.style.display = 'none';
                return;
            }

            // R√©cup√©ration de TOUTES les options
            const eveningValue = document.querySelector('input[name="evening"]:checked')?.value || 'non';
            const difficultAccessValue = document.querySelector('input[name="difficult_access"]:checked')?.value || 'non';
            const parkingValue = document.querySelector('input[name="parking"]:checked')?.value || 'non';
            const cleaningValue = document.querySelector('input[name="cleaning"]:checked')?.value || 'non';
            const wasteRemovalValue = document.querySelector('input[name="waste_removal"]:checked')?.value || 'non';
            const longDistanceValue = document.querySelector('input[name="long_distance"]:checked')?.value || 'non';

            // Gestion affichage parking
            if (parkingValue !== 'non') {
                parkingInputDiv.style.display = 'block';
            } else {
                parkingInputDiv.style.display = 'none';
            }

            let finalHourlyRate = hourlyRate;
            let optionsText = [];
            let optionsCostHT = 0;
            let optionsCostTTC = 0;

            // Suppl√©ment soir√©e
            if (eveningValue === 'oui') {
                finalHourlyRate = hourlyRate * 1.20;
                optionsText.push('Intervention soir√©e (+20% sur le prix HT)');
            }

            // Options avec co√ªt fixe TTC
            if (difficultAccessValue === 'oui') {
                optionsCostTTC += 15;
                optionsText.push('Acc√®s difficile (+15‚Ç¨ TTC)');
            }

            if (cleaningValue === 'oui') {
                optionsCostTTC += 15;
                optionsText.push('Nettoyage (+15‚Ç¨ TTC)');
            }

            if (wasteRemovalValue === 'oui') {
                optionsCostTTC += 20;
                optionsText.push('√âvacuation d√©chets (+20‚Ç¨ TTC)');
            }

            // Parking payant
            if (parkingValue === 'oui') {
                const parkingDays = parseInt(parkingDaysInput.value) || 0;
                if (parkingDays > 0) {
                    const parkingCost = parkingDays * 5;
                    optionsCostTTC += parkingCost;
                    optionsText.push(`Parking payant (${parkingDays} utilisation${parkingDays > 1 ? 's' : ''}: +${parkingCost}‚Ç¨ TTC)`);
                }
            }

            // D√©placement longue distance (HT)
            if (longDistanceValue === 'oui') {
                optionsCostHT += 30;
                optionsText.push('Longue distance (+30‚Ç¨ HT)');
            }

            // Calculs finaux
            const hoursCostHT = finalHourlyRate * hours;
            const tripsCostHT = 30 * trips;
            const subtotalHT = hoursCostHT + tripsCostHT + optionsCostHT;
            const optionsCostHTFromTTC = optionsCostTTC / (1 + TVA_RATE);
            const totalHT = subtotalHT + optionsCostHTFromTTC;
            const tva = totalHT * TVA_RATE;
            const totalTTC = totalHT + tva;
            const finalPrice = totalTTC * CREDIT_RATE;

            // Affichage
            document.getElementById('selectedService').textContent = selectedOption.text;
            document.getElementById('baseHourlyRate').textContent = `${hourlyRate.toFixed(2)}‚Ç¨/h HT`;
            
            if (eveningValue === 'oui') {
                document.getElementById('hourlyRate').textContent = `${finalHourlyRate.toFixed(2)}‚Ç¨/h HT (base + 20% sur le prix HT)`;
            } else {
                document.getElementById('hourlyRate').textContent = `${finalHourlyRate.toFixed(2)}‚Ç¨/h HT`;
            }
            
            document.getElementById('duration').textContent = `${hours}h`;
            document.getElementById('tripsCount').textContent = trips === 1 ? 
                `${trips} d√©placement √ó 30‚Ç¨ = ${tripsCostHT}‚Ç¨ HT` : 
                `${trips} d√©placements √ó 30‚Ç¨ = ${tripsCostHT}‚Ç¨ HT`;
            document.getElementById('optionsDetail').textContent = optionsText.length > 0 ? optionsText.join(' ‚Ä¢ ') : 'Aucune';
            document.getElementById('subtotalHT').textContent = `${totalHT.toFixed(2)}‚Ç¨`;
            document.getElementById('tva').textContent = `${tva.toFixed(2)}‚Ç¨`;
            document.getElementById('totalTTC').textContent = `${totalTTC.toFixed(2)}‚Ç¨`;
            document.getElementById('finalPrice').textContent = `${finalPrice.toFixed(2)}‚Ç¨`;

            // Supprimer disclaimer VAE si pr√©sent
            const existingDisclaimer = document.querySelector('.vae-disclaimer');
            if (existingDisclaimer) {
                existingDisclaimer.remove();
            }

            resultContainer.style.display = 'block';
        }

        // Event listeners
        serviceSelect.addEventListener('change', updateCalculation);
        hoursInput.addEventListener('input', updateCalculation);
        tripsInput.addEventListener('input', updateCalculation);
        parkingDaysInput.addEventListener('input', updateCalculation);
        materialsCheck.addEventListener('change', updateCalculation);
        disclaimerCheck.addEventListener('change', updateCalculation);

        // Event listener sp√©cifique pour validation imm√©diate du disclaimer principal
        disclaimerCheck.addEventListener('change', validateDisclaimerBlock);

        // Event listeners pour les options radio
        const radioInputs = document.querySelectorAll('input[type="radio"]');
        radioInputs.forEach(input => {
            input.addEventListener('change', updateCalculation);
        });

        // Initialisation
        validateDisclaimerBlock(); // Validation imm√©diate au chargement (grise le formulaire au d√©part)
        updateCalculation();
    </script>
</body>
</html>
                
